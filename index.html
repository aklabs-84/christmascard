<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="크리스마스 트리를 중심으로 여러 사람이 카드를 만들고 공유할 수 있는 인터랙티브 웹 애플리케이션">
    <title>Christmas Tree Card - 크리스마스 트리 카드</title>

    <!-- External CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Cute+Font&family=Gamja+Flower&family=Sunflower:wght@300;500;700&family=Jua&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Background animations container -->
    <div id="background-animations"></div>
    <div class="audio-wrapper">
        <button id="audio-toggle" class="audio-toggle-btn">BGM 설정</button>
        <div class="audio-controls hidden" id="audio-controls">
            <button id="audio-play">재생</button>
            <button id="audio-pause">일시정지</button>
            <button id="audio-mute">음소거</button>
            <input type="range" id="audio-volume" min="0" max="1" step="0.01" value="0.3" title="음량">
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">로딩 중...</div>
    </div>

    <!-- Main Tree View -->
    <div id="tree-view" class="view active">
        <!-- Fixed Header -->
        <header class="main-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>🎄 Christmas Tree Card 🎄</h1>
                    <p>크리스마스 트리에 당신의 카드를 달아보세요!</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="app.openCardEditor()">
                        <i class="fas fa-plus"></i> 카드 만들기
                    </button>
                    <button class="btn btn-gold" onclick="app.openMyCards()">
                        <i class="fas fa-folder"></i> 내 카드 관리
                    </button>
                    <button class="btn btn-secondary" onclick="app.randomizeAllPositions()">
                        <i class="fas fa-random"></i> 위치 랜덤 변경
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <div class="tree-layout">
            <div class="tree-container" id="tree-container">
                <div class="tree-pagination">
                    <button class="pagination-btn" id="tree-prev-btn" onclick="app.changeTreePage(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info" id="tree-page-info">1 / 1</span>
                    <button class="pagination-btn" id="tree-next-btn" onclick="app.changeTreePage(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="christmas-tree" id="christmas-tree">
                    <!-- Tree will be rendered here -->
                </div>
            </div>

            <div class="card-list-panel" id="card-list-panel">
                <h3>🎁 카드 목록</h3>
                <div class="card-list-content" id="card-list-content">
                    <p class="empty-message">아직 작성된 카드가 없습니다</p>
                </div>
                <div class="list-pagination" id="list-pagination">
                    <button class="pagination-btn" id="list-prev-btn" onclick="app.changeListPage(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info" id="list-page-info">1 / 1</span>
                    <button class="pagination-btn" id="list-next-btn" onclick="app.changeListPage(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Card Editor View -->
    <div id="card-editor-view" class="view">
        <div class="editor-container">
            <div class="editor-header">
                <h2>✨ 카드 만들기 ✨</h2>
                <button class="btn btn-secondary mt-2" onclick="app.closeCardEditor()">
                    <i class="fas fa-arrow-left"></i> 돌아가기
                </button>
            </div>

            <div class="editor-layout">
                <!-- Tools Panel -->
                <div class="editor-tools">
                    <div id="base-form-panel">
                        <div class="form-group">
                            <label>작성자 이름 *</label>
                            <input type="text" id="author-name" placeholder="이름을 입력하세요" required>
                        </div>

                        <div class="form-group">
                            <label>비밀번호 *</label>
                            <input type="password" id="card-password" placeholder="수정/삭제용 비밀번호" required>
                        </div>

                        <div class="form-group">
                            <label>오브제 선택 *</label>
                            <select id="ornament-type">
                                <option value="star">⭐ 별</option>
                                <option value="snowman">⛄ 눈사람</option>
                                <option value="gift">🎁 선물상자</option>
                                <option value="bauble">🔴 장식볼</option>
                                <option value="candy-cane">🍭 사탕지팡이</option>
                                <option value="bell">🔔 종</option>
                                <option value="snowflake">❄️ 눈송이</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>카드 유형</label>
                            <div>
                                <label style="display: inline-block; margin-right: 1rem;">
                                    <input type="radio" name="card-type" value="normal" checked> 일반 카드
                                </label>
                                <label style="display: inline-block;">
                                    <input type="radio" name="card-type" value="url"> URL 카드
                                </label>
                            </div>
                        </div>

                        <div class="form-group hidden" id="url-input-group">
                            <label>URL 주소</label>
                            <input type="url" id="card-url" placeholder="https://example.com">
                        </div>

                        <div id="normal-card-tools">
                            <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="app.addTextBox()">
                                <i class="fas fa-font"></i> 텍스트 추가
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;" onclick="app.addSticker()">
                                <i class="fas fa-star"></i> 스티커 추가
                            </button>
                        </div>
                    </div>

                    <div id="text-properties-panel" class="properties-panel hidden">
                        <h4 style="margin-bottom: 1rem; color: var(--christmas-gold);">텍스트 속성</h4>

                        <div class="property-menu-row">
                            <button class="property-menu-btn" data-target="text-font-section">폰트</button>
                            <button class="property-menu-btn" data-target="text-size-section">글꼴 크기</button>
                            <button class="property-menu-btn" data-target="text-color-section">색상</button>
                            <button class="property-menu-btn" data-target="text-align-section">정렬</button>
                        </div>

                        <div id="text-font-section" class="property-section hidden">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>폰트</label>
                                <select id="text-font">
                                    <option value="Jua">Jua</option>
                                    <option value="Nanum Pen Script">Nanum Pen Script</option>
                                    <option value="Cute Font">Cute Font</option>
                                    <option value="Gamja Flower">Gamja Flower</option>
                                    <option value="Sunflower">Sunflower</option>
                                </select>
                            </div>
                        </div>

                        <div id="text-size-section" class="property-section hidden">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>글꼴 크기</label>
                                <input type="range" id="text-size" min="12" max="72" value="16" oninput="app.updateTextSize(this.value)">
                                <span id="text-size-value">16px</span>
                            </div>
                        </div>

                        <div id="text-color-section" class="property-section hidden">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>색상</label>
                                <input type="color" id="text-color" value="#000000">
                            </div>
                        </div>

                        <div id="text-align-section" class="property-section hidden">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>정렬</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn-icon" onclick="app.setTextAlign('left')" title="왼쪽 정렬">
                                        <i class="fas fa-align-left"></i>
                                    </button>
                                    <button class="btn-icon" onclick="app.setTextAlign('center')" title="가운데 정렬">
                                        <i class="fas fa-align-center"></i>
                                    </button>
                                    <button class="btn-icon" onclick="app.setTextAlign('right')" title="오른쪽 정렬">
                                        <i class="fas fa-align-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="app.deleteSelectedElement()">
                                <i class="fas fa-trash"></i> 삭제
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;" onclick="app.showBaseTools()">
                                <i class="fas fa-arrow-left"></i> 기본 메뉴
                            </button>
                        </div>
                    </div>

                    <div id="image-properties-panel" class="properties-panel hidden">
                        <h4 style="margin-bottom: 1rem; color: var(--christmas-gold);">스티커 속성</h4>

                        <div class="form-group">
                            <label>크기 조절 (모서리 드래그)</label>
                            <p style="font-size: 0.75rem; color: #aaa; margin-top: 0.25rem;">
                                스티커 모서리를 드래그하여 크기를 조절하세요
                            </p>
                        </div>

                        <div class="form-group">
                            <label>스티커 맞춤</label>
                            <select id="image-fit" onchange="app.setImageFit(this.value)">
                                <option value="contain">전체 보기</option>
                                <option value="cover">꽉 채우기</option>
                                <option value="fill">늘리기</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>회전</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-icon" onclick="app.rotateImage(0)" title="0°">
                                    <i class="fas fa-undo"></i> 0°
                                </button>
                                <button class="btn-icon" onclick="app.rotateImage(90)" title="90°">
                                    90°
                                </button>
                                <button class="btn-icon" onclick="app.rotateImage(180)" title="180°">
                                    180°
                                </button>
                                <button class="btn-icon" onclick="app.rotateImage(270)" title="270°">
                                    270°
                                </button>
                            </div>
                        </div>

                        <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="app.cropSticker()">
                            <i class="fas fa-crop"></i> 자르기
                        </button>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="app.deleteSelectedElement()">
                            <i class="fas fa-trash"></i> 삭제
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="app.showBaseTools()">
                            <i class="fas fa-arrow-left"></i> 기본 메뉴
                        </button>
                    </div>
                </div>

                <!-- Canvas Panel -->
                <div class="editor-canvas-wrapper">
                    <h3 class="text-center mb-2" style="color: var(--christmas-gold);">미리보기</h3>
                    <div class="editor-canvas" id="editor-canvas">
                        <!-- Card elements will be added here -->
                    </div>

                    <div class="action-buttons mt-3">
                        <button class="btn btn-primary" onclick="app.saveCard()">
                            <i class="fas fa-save"></i> 저장하기
                        </button>
                        <button class="btn btn-secondary" onclick="app.closeCardEditor()">
                            <i class="fas fa-times"></i> 취소
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Card Detail Modal -->
    <div class="modal" id="card-detail-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeCardDetail()">
                <i class="fas fa-times"></i>
            </button>
            <div id="card-detail-content">
                <!-- Card content will be rendered here -->
            </div>
            <div class="action-buttons mt-3">
                <button class="btn btn-primary" onclick="app.deleteCard()">
                    <i class="fas fa-trash"></i> 삭제
                </button>
                <button class="btn btn-gold" onclick="app.shareCard()">
                    <i class="fas fa-share"></i> 공유
                </button>
            </div>
        </div>
    </div>

    <!-- My Cards Modal -->
    <div class="modal" id="my-cards-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeMyCards()">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="text-center mb-3" style="color: var(--christmas-red);">내 카드 관리</h2>
            <div class="form-group">
                <label>작성자 이름으로 검색</label>
                <input type="text" id="search-author-name" placeholder="이름을 입력하세요">
                <button class="btn btn-primary mt-1" onclick="app.searchMyCards()">
                    <i class="fas fa-search"></i> 검색
                </button>
            </div>
            <div id="my-cards-list" class="mt-3">
                <!-- Cards list will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Crop Overlay (not used on tree page, kept to satisfy shared script) -->
    <div id="crop-overlay" class="crop-overlay hidden">
        <div class="crop-controls">
            <h3 style="color: var(--christmas-gold); margin-bottom: 1rem;">스티커 자르기</h3>
            <p style="color: white; margin-bottom: 1rem;">자르기 영역을 조절하세요</p>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-primary" onclick="app.applyCrop()">
                    <i class="fas fa-check"></i> 적용
                </button>
                <button class="btn btn-secondary" onclick="app.cancelCrop()">
                    <i class="fas fa-times"></i> 취소
                </button>
            </div>
        </div>
        <div id="crop-container" class="crop-container">
            <!-- Image and crop box will be added here -->
        </div>
    </div>

    <!-- External JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.19/dist/interact.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- Configuration (load before app.js) -->
    <script src="config.js"></script>

    <!-- Custom JavaScript -->
    <script src="app.js"></script>
</body>
</html>
